
<!-- index.html: -->




<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Smart</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index_styles.css') }}" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* SweetAlert2 custom styling */
    .my-swal-popup {
      border-radius: 12px;
      font-family: "Helvetica Neue", Arial, sans-serif;
    }
    .my-confirm-btn {
      background-color: #4f46e5;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 600;
    }
    .my-cancel-btn {
      color: #6b7280;
      background-color: #f3f4f6;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 600;
    }
    .my-delete-btn {
      background-color: #dc2626;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 600;
    }
  </style>

</head>

<body>
  <div id="top">
    <p id="first-words">study smarter, </p>
    <p id="second-words">STUDY SMART</p>
  </div>

  <div class="header-container">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="question" role="img" aria-label="Help Icon">
      <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
    </svg>

    <form method="POST" action="{{ url_for('logout') }}" style="display: inline;">
      <button type="submit" class="logout-btn">LOGGA UT</button>
    </form>

    <button id="btn-2" class="head-btn">KALENDER</button>

    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="user_icon" role="img" aria-label="User Icon">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
    </svg>
  </div>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages-container">
        {% for category, message in messages %}
          <div class="flash-message flash-{{ category }}">
            {{ message }}
            <button class="flash-close" onclick="this.parentElement.remove()">&times;</button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="center-container">
    <div class="left-container">
      <div class="left-btn-container">
        <button id="left-subject-btn">SKAPA ÄMNE</button>
        <div id="subject-modal" class="modal">
          <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Skapa Ämne</h2>
            
            <div class="create-subject-section">
              <div class="create-subject-tabs">
                <button class="tab-button active" onclick="showTab('create')">Skapa Ämne</button>
                <button class="tab-button" onclick="showTab('join')">Anslut till Ämne</button>
              </div>
    
              <!-- Create Subject Tab -->
              <div id="create-tab" class="tab-content active">
                <form id="create-subject-form">
                  <div class="form-group">
                    <label for="subject-name">Namn:</label>
                    <input type="text" id="subject-name" name="subject-name" required>
                  </div>
                  <div class="form-group">
                    <label>
                      <input type="checkbox" id="is-shared" name="is-shared"> 
                      Aktivera Delning 
                    </label>
                  </div>
                  <button type="submit">Skapa Ämne</button>
                </form>
              </div>
    
              <!-- Join Subject Tab -->
              <div id="join-tab" class="tab-content">
                <form id="join-subject-form">
                  <div class="form-group">
                    <label for="share-code">Delningskod:</label>
                    <input type="text" id="share-code" name="share-code" placeholder="Skriv in 8-tecken" maxlength="8" required>
                  </div>
                  <button type="submit">Anslut</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <p id="subject-header">Ämnen:</p>

      <!-- Ersätt den befintliga subject list-sektionen (runt rad 120-180) med denna kod -->
      <div class="subject-list">
        <!-- Owned subjects -->
        {% for subject in owned_subjects %}
          <div class="subject owned-subject">
            <!-- Subject link with proper event handling -->
            <a href="{{ url_for('subject', subject_name=subject.name) }}" class="subject-link">
              <div class="subject-button owned">
                <span class="subject-title">{{ subject.name }}</span>
                <div class="subject-badges">
                  <span class="subject-role-badge">Skapare</span>
                  {% if subject.due_flashcards > 0 %}
                    <span class="due-badge">{{ subject.due_flashcards }}</span>
                  {% endif %}
                </div>
              </div>
            </a>
            
            <!-- Delete button with proper event handling -->
            <form method="POST" action="{{ url_for('delete_subject') }}" class="delete-form" onsubmit="return false;">
              <input type="hidden" name="subject" value="{{ subject.name }}" />
              <button type="button" class="delete-subject-btn" title="Remove subject" onclick="event.stopPropagation(); confirmDelete('{{ subject.name }}', this.closest('form'));">×</button>
            </form>
          </div>
        {% endfor %}

        <!-- Shared subjects -->
        {% for subject in shared_subjects %}
          <div class="subject shared-subject">
            <!-- Subject link with proper event handling -->
            <a href="{{ url_for('subject', subject_name=subject.name) }}" class="subject-link">
              <div class="subject-button shared">
                <span class="subject-title">{{ subject.name }}</span>
                <div class="subject-badges">
                  <span class="subject-role-badge">Member</span>
                  {% if subject.due_flashcards > 0 %}
                    <span class="due-badge">{{ subject.due_flashcards }}</span>
                  {% endif %}
                  {% if subject.pending_assignments > 0 %}
                    <span class="assignment-badge">{{ subject.pending_assignments }}</span>
                  {% endif %}
                </div>
              </div>
            </a>
            
            <!-- Leave button with proper event handling -->
            <form method="POST" action="{{ url_for('leave_subject', subject_id=subject.id) }}" class="delete-form" onsubmit="return false;">
              <button type="button" class="leave-subject-btn" title="Leave subject" onclick="event.stopPropagation(); confirmLeave('{{ subject.name }}', this.closest('form'));">⤷</button>
            </form>
          </div>
        {% endfor %}

        <!-- Show message if no subjects -->
        {% if not owned_subjects and not shared_subjects %}
          <div class="no-subjects-message">
            <p>Inga ämnen här. Skapa ditt första ämne eller anslut till ett!</p>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="right-container">
      <div class="right-quiz-btn-container">
        <a href="{{ url_for('create_quiz') }}">
          <button id="right-quiz-btn">Skapa Quiz</button>
        </a>
      </div>
      <div class="products-header" id="date-header">
        <button id="prev-day-btn" aria-label="Previous day">&lt;</button>
        <span id="current-date"></span>
        <button id="next-day-btn" aria-label="Next day">&gt;</button>
      </div>
      
      <!-- Right content wrapper för desktop layout -->
      <div class="right-content-wrapper">
        <!-- Schema sektion -->
        <div class="schedule-container" id="schedule-container">
          <h3 class="schedule-header">Schema</h3>
          <div class="schedule-content">
            <!-- Schema innehåll kommer här -->
            <p class="no-schedule">Inget schema för idag</p>
          </div>
        </div>
        
        <!-- Quiz sektion -->
        <div class="products-container" id="quizzes-container">
          <!-- Quizzes will be loaded here via JavaScript -->
        </div>
      </div>
    </div>

    
  </div>

  <!-- Rest of your modals remain the same -->
  <div id="subjects-detail-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Ämnes Management</h2>
      
      <!-- Owned Subjects -->
      {% if owned_subjects %}
      <div class="subjects-section">
        <h3>Mina Ämnen</h3>
        <div class="subjects-grid">
          {% for subject in owned_subjects %}
          <div class="subject-card owned-subject">
            <div class="subject-header">
              <h4>{{ subject.name }}</h4>
              <span class="subject-role owner">Skapare</span>
            </div>
            <div class="subject-stats">
              <span class="stat">{{ subject.quiz_count }} quizzes</span>
              <span class="stat">{{ subject.flashcard_count }} flashcards</span>
              {% if subject.due_flashcards > 0 %}
                <span class="stat due">{{ subject.due_flashcards }} due</span>
              {% endif %}
            </div>
            <div class="subject-actions">
              <a href="{{ url_for('subject', subject_name=subject.name) }}" class="btn btn-primary">Open</a>
              <button class="btn btn-secondary" onclick="toggleSharing({{ subject.id }}, {{ subject.is_shared|lower }})">
                {% if subject.is_shared %}Disable Sharing{% else %}Enable Sharing{% endif %}
              </button>
              {% if subject.is_shared %}
              <button class="btn btn-info" onclick="showShareCode('{{ subject.share_code }}')">Visa Kod</button>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Shared Subjects -->
      {% if shared_subjects %}
      <div class="subjects-section">
        <h3>Delad Ämnen</h3>
        <div class="subjects-grid">
          {% for subject in shared_subjects %}
          <div class="subject-card shared-subject">
            <div class="subject-header">
              <h4>{{ subject.name }}</h4>
              <span class="subject-role member">Medlem</span>
            </div>
            <div class="subject-stats">
              <span class="stat">{{ subject.quiz_count }} quizzes</span>
              <span class="stat">{{ subject.flashcard_count }} flashcards</span>
              {% if subject.due_flashcards > 0 %}
              <span class="stat due">{{ subject.due_flashcards }} due</span>
              {% endif %}
            </div>
            <div class="subject-actions">
              <a href="{{ url_for('subject', subject_name=subject.name) }}" class="btn btn-primary">Öppna</a>
              <button class="btn btn-danger" onclick="leaveSubject({{ subject.id }})">Lämna</button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if not owned_subjects and not shared_subjects %}
      <div class="no-subjects">
        <p>Inga ämnen än. Skapa ditt första eller anslut till ett!</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Share Code Modal -->
  <div id="share-code-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Delningskod</h3>
      <p>Dela denna kod med andra så att de kan ansluta sig:</p>
      <div class="share-code-display">
        <input type="text" id="share-code-text" readonly>
        <button onclick="copyShareCode()">Copy</button>
      </div>
    </div>
  </div>

  <!-- Rest of your modals and JavaScript remain the same -->
  <div id="new-data-modal" class="modal">
    <div class="modal-content">
      <button id="close-new-data" class="close">&times;</button>
      <h2>New Data</h2>

      <label for="pdf-upload">Upload a PDF:</label>
      <input type="file" id="pdf-upload" accept="application/pdf" />

      <div id="pdf-viewer-container" class="pdf-viewer-container">
        <iframe id="pdf-viewer" class="pdf-viewer" frameborder="0"></iframe>
      </div>

      <div id="description-examples" class="description-examples">
        <strong>Examples of descriptions (click to use):</strong>
        <ul class="description-list">
          <li class="desc-example">Make a short recap.</li>
          <li class="desc-example">Make a long recap.</li>
          <li class="desc-example">Pick out key terms.</li>
          <li class="desc-example">Key concepts.</li>
          <li class="desc-example">Revision notes.</li>
          <li class="desc-example">Overview.</li>
        </ul>

        <form method="POST" enctype="multipart/form-data">
          <label for="subject">Select a subject:</label>
          <select name="subject" id="subject" required>
            <option value="" disabled selected hidden>Select a subject</option>
            {% for subject in owned_subjects %}
              <option value="{{ subject.name }}">{{ subject.name }}</option>
            {% endfor %}
            {% for subject in shared_subjects %}
              <option value="{{ subject.name }}">{{ subject.name }} (Shared)</option>
            {% endfor %}
          </select>
        </form>
      </div>

      <label for="pdf-notes" class="notes-label">Add notes about the PDF:</label>
      <textarea id="pdf-notes" class="notes-textarea" rows="5"></textarea>

      <div id="generated-pdf-container" class="pdf-viewer-container">
        <h3>Generated PDF:</h3>
        <iframe id="generated-pdf" class="pdf-viewer" frameborder="0"></iframe>
      </div>
    </div>
  </div>

  <div id="calendar-modal" class="modal">
    <div class="calendar-content">
      <span class="calendar-close">&times;</span>
      <h2>Kalender</h2>

      <div class="calendar-header">
        <button id="prev-month-btn">&lt;</button>
        <span id="month-year"></span>
        <button id="next-month-btn">&gt;</button>
      </div>

      <div class="calendar-main-container">
        <table id="calendar-table">
          <thead>
            <tr>
              <th>Må</th><th>Ti</th><th>On</th><th>To</th><th>Fr</th><th>Lö</th><th>Sö</th>
            </tr>
          </thead>
          <tbody id="calendar-body">
          </tbody>
        </table>

        <div id="events-display" class="events-display" style="display: none;">
          <div class="events-header">
            <h3 id="selected-date-title">Händelser under [Date]</h3>
            <button id="close-events-display" class="close-events-btn">&times;</button>
          </div>
          <div id="events-list" class="events-list">
            <!-- Events will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="add-event-modal" class="modal-a">
  <button id="add-event-modal-close">&times;</button>
  <h2 id="add-event-title">Lägg till händelse</h2>

  <!-- Subject Dropdown -->
  <div class="form-group">
    <label for="subject-select">Välj ett Ämne:</label>
    <select id="subject-select" required class="subject-select">
      <option value="" disabled selected hidden>Välj ett Ämne</option>
      {% for subject in owned_subjects %}
        <option value="{{ subject.name }}" data-user-role="owner">{{ subject.name }}</option>
      {% endfor %}
      {% for subject in shared_subjects %}
        <option value="{{ subject.name }}" data-user-role="member">{{ subject.name }} (Member)</option>
      {% endfor %}
    </select>
  </div>

  <!-- Test Type Dropdown -->
  <div class="form-group">
    <label for="test-type-select">Välj typ av test</label>
    <select id="test-type-select" required class="test-type-select">
      <option value="" disabled selected hidden>Välj typ av test</option>
      <option value="assessment">Inlämning</option>
      <option value="exam">Prov</option>
    </select>
  </div>
  
  <!-- Event Title Input -->
  <div class="form-group">
    <label for="event-title">Titel</label>
    <input type="text" id="event-title" required>
  </div>
  
  <!-- Event Description Textarea -->
  <div class="form-group">
    <label for="event-description">Beskrivning:</label>
    <textarea id="event-description" rows="3"></textarea>
  </div>

  <!-- Share with Members Checkbox (endast för ägare) -->
  <div class="form-group" id="share-option-group" style="display: none;">
    <label class="checkbox-label">
      <input type="checkbox" id="share-with-members">
      Dela denna händelse med alla medlemmar av ämnet
      <span class="checkbox-info">Medlemmar kommer se händelsen i sina kalendrar</span>
    </label>
  </div>
  
  <!-- Action Buttons -->
  <div class="form-actions">
    <button type="button" id="save-event-btn" class="save-btn">Spara Händelse</button>
    <button type="button" id="cancel-event-btn" class="cancel-btn">Avbryt</button>
  </div>
</div>

<script>
// ----------- Combined JavaScript from index_script.js and index.html -----------

document.addEventListener('DOMContentLoaded', () => {
  // ----------- Part 0: Fetch the entire repetition schedule -----------
  let schedule = {};
  let userSubjects = {};

  async function fetchSchedule() {
    try {
      const res = await fetch('/flashcards_by_date');
      if (!res.ok) throw new Error(res.statusText);
      schedule = await res.json();
      console.log('[DEBUG] Fetched schedule:', schedule);
    } catch (e) {
      console.error('Could not load repetition schedule:', e);
    }
  }

  async function loadUserSubjects() {
    try {
      const response = await fetch('/api/user_subjects');
      if (response.ok) {
        const data = await response.json();
        userSubjects = data.reduce((acc, subject) => {
          acc[subject.id] = subject.user_role; // 'owner' eller 'member'
          return acc;
        }, {});
        console.log('[DEBUG] User subjects loaded:', userSubjects);
      }
    } catch (error) {
      console.error('Error loading user subjects:', error);
    }
  }

  // ----------- Part 1: Date selector + quiz loading per date -----------
  let currentDate = new Date();

  function formatKey(d) {
    return d.toISOString().split('T')[0];
  }

  function updateDateHeader() {
    const opts = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').textContent =
      currentDate.toLocaleDateString(undefined, opts);
  }

  function markCurrentLesson() {
      const now = new Date();
      const currentTime = now.toTimeString().slice(0, 5); // Format: HH:MM
      
      document.querySelectorAll('.schedule-item').forEach(item => {
          const startTime = item.querySelector('.time-start')?.textContent;
          const endTime = item.querySelector('.time-end')?.textContent;
          
          if (startTime && endTime && currentTime >= startTime && currentTime <= endTime) {
              item.classList.add('current-lesson');
          } else {
              item.classList.remove('current-lesson');
          }
      });
  }

  
  async function loadQuizzesForDate() {
      // Hämta alltid senaste schemat
      await fetchSchedule();

      const key = formatKey(currentDate);
      const entries = schedule[key] || [];
      const container = document.getElementById('quizzes-container');
      container.innerHTML = ''; 

      console.log(`[DEBUG] Loading quizzes for date: ${key}, found ${entries.length} entries`);

      // Din befintliga quiz-loading logik här...
      if (entries.length === 0) {
          container.innerHTML = '<p>No repetitions scheduled for this date.</p>';
      } else {
          // Förbättrad grupp-logik som räknar faktiska frågor
          const grouped = {};
          entries.forEach(e => {
              const id = `${e.subject}|||${e.topic}`;
              if (!grouped[id]) {
                  grouped[id] = { 
                      subject: e.subject, 
                      topic: e.topic, 
                      count: 0,
                      questions: [],
                      user_role: e.user_role || 'unknown',
                      is_shared_subject: e.is_shared_subject || false,
                      quiz_id: e.quiz_id || null,
                      is_personal_quiz: e.is_personal_quiz || false
                  };
              }
              
              if (e.questions && Array.isArray(e.questions)) {
                  grouped[id].count += e.questions.length;
                  grouped[id].questions.push(...e.questions);
              } else {
                  grouped[id].count++;
              }
          });

          console.log('[DEBUG] Grouped quizzes:', grouped);

          Object.values(grouped).forEach(qz => {
              const link = `/daily_quiz/${key}/` +
                          encodeURIComponent(qz.subject) + '/' +
                          encodeURIComponent(qz.topic);
              const card = document.createElement('div');
              card.className = 'quiz-card';
              
              const canLeave = qz.user_role === 'member' && 
                              qz.is_shared_subject && 
                              !qz.is_personal_quiz && 
                              qz.quiz_id;
              
              console.log(`[DEBUG] Quiz: ${qz.topic}, canLeave: ${canLeave}`);
              
              card.innerHTML = `
                  <h3>${qz.subject} – ${qz.topic}</h3>
                  <p>${qz.count} question${qz.count > 1 ? 's' : ''}</p>
                  <div class="quiz-actions">
                      <a href="${link}"><button class="start-quiz-btn">Start Quiz</button></a>
                      ${canLeave ? `<button class="leave-quiz-btn" onclick="leaveQuiz('${qz.subject}', '${qz.topic}', ${qz.quiz_id || 'null'})" title="Leave this shared quiz">✖</button>` : ''}
                  </div>
              `;
              container.appendChild(card);
          });
      }

      // LÄGG TILL: Ladda schema för samma datum
      await loadScheduleForDate(currentDate);
  }

  // Datum‐knapparna
  document.getElementById('prev-day-btn').addEventListener('click', async () => {
      currentDate.setDate(currentDate.getDate() - 1);
      updateDateHeader();
      await loadQuizzesForDate(); // Detta kommer nu också ladda schemat
  });

  document.getElementById('next-day-btn').addEventListener('click', async () => {
      currentDate.setDate(currentDate.getDate() + 1);
      updateDateHeader();
      await loadQuizzesForDate(); // Detta kommer nu också ladda schemat
  });

  // ----------- Part 2: Calendar modal and event handling -----------

  let calendarCurrentDate = new Date(); // Add this variable to track calendar's current month/year

  const calendarBtn = document.getElementById('btn-2');
  const calendarModal = document.getElementById('calendar-modal');
  const calendarCloseBtn = calendarModal?.querySelector('.calendar-close');
  const monthYearSpan = document.getElementById('month-year');
  const prevMonthBtn = document.getElementById('prev-month-btn');
  const nextMonthBtn = document.getElementById('next-month-btn');
  const calendarBody = document.getElementById('calendar-body');

  const addEventModal = document.getElementById('add-event-modal');
  const addEventModalClose = document.getElementById('add-event-modal-close');
  const saveEventBtn = document.getElementById('save-event-btn');
  const cancelEventBtn = document.getElementById('cancel-event-btn');

  const eventsDisplay = document.getElementById('events-display');
  const selectedDateTitle = document.getElementById('selected-date-title');
  const eventsList = document.getElementById('events-list');
  const closeEventsDisplay = document.getElementById('close-events-display');

  let selectedDate = null;
  let calendarEvents = [];

  async function loadEvents() {
    try {
      const resp = await fetch('/api/events');
      if (resp.ok) {
        calendarEvents = await resp.json();
        if (calendarModal.style.display === 'block') {
          renderCalendar(currentDate);
        }
      }
    } catch (err) {
      console.error('Error loading events:', err);
    }
  }

  async function loadScheduleForDate(date) {
      try {
          const dateString = date.toISOString().split('T')[0]; // Format: YYYY-MM-DD
          const response = await fetch(`/api/schedule/${dateString}`);
          
          if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          console.log('[DEBUG] Schedule data received:', data);
          
          displaySchedule(data);
          
      } catch (error) {
          console.error('Error loading schedule:', error);
          displayScheduleError('Kunde inte ladda schema');
      }
  }


  function displaySchedule(scheduleData) {
      const scheduleContainer = document.querySelector('.schedule-content');
      
      if (!scheduleContainer) {
          console.error('Schedule container not found');
          return;
      }
      
      if (scheduleData.status === 'success' && scheduleData.schedule.length > 0) {
          const today = new Date();
          const isToday = currentDate.toDateString() === today.toDateString();
          
          let scheduleHTML = `
              
          `;
          
          scheduleData.schedule.forEach(lesson => {
              scheduleHTML += `
                  <div class="schedule-item">
                      <div class="schedule-time">
                          <span class="time-start">${lesson.start_time}</span>
                          <span class="time-separator">-</span>
                          <span class="time-end">${lesson.end_time}</span>
                      </div>
                      <div class="schedule-details">
                          <div class="schedule-subject">${lesson.subject}</div>
                          <div class="schedule-room">${lesson.room}</div>
                      </div>
                  </div>
              `;
          });
          
          scheduleHTML += '</div>';
          scheduleContainer.innerHTML = scheduleHTML;
          
          // Markera aktuell lektion om det är idag
          if (isToday) {
              setTimeout(markCurrentLesson, 100);
          }
          
      } else {
          const message = scheduleData.message || 'Inget schema för idag';
          scheduleContainer.innerHTML = `
              <div class="no-schedule">
                  <p>${message}</p>
              </div>
          `;
      }
  }


  function displayScheduleError(errorMessage) {
      const scheduleContainer = document.querySelector('.schedule-content');
      
      if (scheduleContainer) {
          scheduleContainer.innerHTML = `
              <div class="schedule-error">
                  <p>${errorMessage}</p>
              </div>
          `;
      }
  }
  





  // Calendar modal close button
  calendarCloseBtn?.addEventListener('click', () => {
    calendarModal.style.display = 'none';
    // Also hide events display when closing calendar
    eventsDisplay.style.display = 'none';
  });

  // Add event modal close button  
  addEventModalClose?.addEventListener('click', () => {
    addEventModal.style.display = 'none';
    clearEventForm();
  });
  // Events display close button
  closeEventsDisplay?.addEventListener('click', () => {
    eventsDisplay.style.display = 'none';
  });



  // Update the window click handler to properly handle modal closing
  window.addEventListener('click', e => {
    // Calendar modal
    if (e.target === calendarModal) {
      calendarModal.style.display = 'none';
      eventsDisplay.style.display = 'none';
    }
    
    // Add event modal
    if (e.target === addEventModal) {
      addEventModal.style.display = 'none';
      clearEventForm();
    }
    
    // Subject modal
    if (e.target === subjectModal) {
      subjectModal.style.display = 'none';
    }
  });


  async function saveEvent(eventData) {
    try {
      const resp = await fetch('/api/events', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData)
      });
      if (!resp.ok) throw new Error('Failed to save event');
      calendarEvents.push(eventData);
      renderCalendar(currentDate);
    } catch (error) {
      console.error('Error saving event:', error);
      alert('Error saving event.');
    }
  }

  // Update the calendar button click handler:
  calendarBtn?.addEventListener('click', () => {
    calendarModal.style.display = 'block';
    calendarCurrentDate = new Date(); // Reset to current month when opening
    renderCalendar(calendarCurrentDate);
  });

  // Update the month navigation buttons:
  prevMonthBtn?.addEventListener('click', () => {
    calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() - 1);
    renderCalendar(calendarCurrentDate);
  });

  nextMonthBtn?.addEventListener('click', () => {
    calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() + 1);
    renderCalendar(calendarCurrentDate);
  });

  saveEventBtn?.addEventListener('click', async () => {
    const subject = document.getElementById('subject-select').value;
    const testType = document.getElementById('test-type-select').value;
    const title = document.getElementById('event-title').value;
    const desc = document.getElementById('event-description').value;
    const shareWithMembers = document.getElementById('share-with-members')?.checked || false;

    if (subject && testType && title && selectedDate) {
      const eventData = {
        date: formatKey(selectedDate),
        subject: subject,
        testType: testType,
        title: title,
        description: desc,
        share_with_members: shareWithMembers
      };
      try {
        const response = await fetch('/api/events', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(eventData)
        });
        const data = await response.json();
        if (response.ok && data.status === 'success') {
          alert(data.message);
          await loadEvents();
          renderCalendar(currentDate);
          addEventModal.style.display = 'none';
          clearEventForm();
        } else {
          alert(data.error || 'Failed to create event');
        }
      } catch (error) {
        console.error('Error creating event:', error);
        alert('Network error occurred while creating event');
      }
    } else {
      alert('Please fill all required fields');
    }
  });

  cancelEventBtn?.addEventListener('click', () => { 
    addEventModal.style.display = 'none'; 
    clearEventForm(); 
  });

  function clearEventForm() {
    ['subject-select','test-type-select','event-title','event-description'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });
    const shareCheckbox = document.getElementById('share-with-members');
    if (shareCheckbox) shareCheckbox.checked = false;
    selectedDate = null;
  }

  function getEventsForDate(d) {
    const ds = formatKey(d);
    return calendarEvents.filter(e => e.date === ds);
  }

  function displayEventsForDate(d) {
    const evs = getEventsForDate(d);
    selectedDateTitle.textContent =
      `Events for ${d.toLocaleDateString('en-US',{ weekday:'long', year:'numeric', month:'long', day:'numeric'})}`;
    
    if (evs.length === 0) {
      eventsList.innerHTML = '<p class="no-events">No events scheduled for this date.</p>';
    } else {
      eventsList.innerHTML = evs.map(e => `
        <div class="event-item ${e.is_shared ? 'shared-event' : 'private-event'}">
          <div class="event-header">
            <h4>${e.title}</h4>
            <div class="event-badges">
              <span class="test-type-badge">${e.testType}</span>
              ${e.is_shared ? '<span class="shared-badge">Shared</span>' : ''}
            </div>
          </div>
          <div class="event-details">
            <p><strong>Subject:</strong> ${e.subject}</p>
            ${e.description ? `<p><strong>Description:</strong> ${e.description}</p>` : ''}
          </div>
          <div class="event-actions">
            ${canDeleteEvent(e) ? `<button onclick="deleteEvent(${e.id})" class="delete-btn">Delete</button>` : ''}
            ${canToggleSharing(e) ? `<button onclick="toggleEventSharing(${e.id}, ${e.is_shared})" class="share-btn">${e.is_shared ? 'Make Private' : 'Share with Members'}</button>` : ''}
          </div>
        </div>
      `).join('');
    }
    eventsDisplay.style.display = 'block';
  }



  // Function to handle leaving a quiz (for members only)
  window.leaveQuiz = async function(subject, topic, quizId) {
      const result = await Swal.fire({
        title: 'Är du säker?',
        html: `
          Vill du lämna quizet "<strong>${topic}</strong>" i ämnet "<strong>${subject}</strong>"?<br><br>
          <ul style="text-align:left">
            <li>Alla dina flashcards försvinner</li>
            <li>Det tas bort från din repetitionsplan</li>
            <li>Åtgärden går inte att ångra</li>
          </ul>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Ja, lämna',
        cancelButtonText: 'Nej, stanna kvar',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn',
          cancelButton: 'my-cancel-btn'
        }
      });

      if (!result.isConfirmed) return;
      
      try {
          const response = await fetch('/api/leave_quiz', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  subject: subject,
                  topic: topic,
                  quiz_id: quizId
              })
          });
          
          const data = await response.json();
          
          if (response.ok && data.status === 'success') {
              await Swal.fire({
                title: 'Klart!',
                text: data.message,
                icon: 'success',
                customClass: {
                  popup: 'my-swal-popup',
                  confirmButton: 'my-confirm-btn'
                }
              });
              // Refresh the page to update the quiz list
              await fetchSchedule();
              await loadQuizzesForDate();
          } else {
              await Swal.fire({
                title: 'Fel!',
                text: data.error || 'Failed to leave quiz',
                icon: 'error',
                customClass: {
                  popup: 'my-swal-popup',
                  confirmButton: 'my-confirm-btn'
                }
              });
          }
      } catch (error) {
          console.error('Error leaving quiz:', error);
          await Swal.fire({
            title: 'Fel!',
            text: 'Network error occurred while leaving quiz',
            icon: 'error',
            customClass: {
              popup: 'my-swal-popup',
              confirmButton: 'my-confirm-btn'
            }
          });
      }
  };

  window.toggleEventSharing = async function(eventId, isCurrentlyShared) {
    try {
      const response = await fetch(`/api/events/${eventId}/share`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      const data = await response.json();
      if (response.ok && data.status === 'success') {
        await Swal.fire({
          title: 'Klart!',
          text: data.message,
          icon: 'success',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
        await loadEvents();
        renderCalendar(currentDate);
        if (eventsDisplay.style.display === 'block' && selectedDate) {
          displayEventsForDate(selectedDate);
        }
      } else {
        await Swal.fire({
          title: 'Fel!',
          text: data.error || 'Failed to update sharing settings',
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
      }
    } catch (error) {
      console.error('Error toggling event sharing:', error);
      await Swal.fire({
        title: 'Fel!',
        text: 'Network error occurred while updating sharing settings',
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    }
  };

  function canDeleteEvent(event) {
    if (!event.subject_id) {
      return true;
    }
    const userRole = userSubjects[event.subject_id];
    return userRole === 'owner';
  }

  function canToggleSharing(event) {
    if (!event.subject_id) {
      return true;
    }
    const userRole = userSubjects[event.subject_id];
    return userRole === 'owner';
  }

  window.deleteEvent = async function(id) {
    const result = await Swal.fire({
      title: 'Ta bort event?',
      text: 'Är du säker på att du vill ta bort detta event?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ja, ta bort',
      cancelButtonText: 'Avbryt',
      customClass: {
        popup: 'my-swal-popup',
        confirmButton: 'my-delete-btn',
        cancelButton: 'my-cancel-btn'
      }
    });

    if (!result.isConfirmed) return;

    try {
      const response = await fetch(`/api/events/${id}`, { 
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' }
      });
      const data = await response.json();
      if (response.ok && data.status === 'success') {
        await Swal.fire({
          title: 'Borttaget!',
          text: data.message,
          icon: 'success',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
        await loadEvents();
        renderCalendar(currentDate);
        if (eventsDisplay.style.display === 'block' && selectedDate) {
          displayEventsForDate(selectedDate);
        }
      } else {
        await Swal.fire({
          title: 'Fel!',
          text: data.error || 'Failed to delete event',
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
      }
    } catch (error) {
      console.error('Error deleting event:', error);
      await Swal.fire({
        title: 'Fel!',
        text: 'Network error occurred while deleting event',
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    }
  };

  window.addEventListener('click', e => {
    if (e.target === calendarModal) {
      calendarModal.style.display = 'none';
    }
    if (addEventModal && addEventModal.style.display === 'block' && !e.target.closest('#add-event-modal')) {
      addEventModal.style.display = 'none';
      clearEventForm();
    }
    if (e.target === subjectModal) {
      subjectModal.style.display = 'none';
    }
  });

  

  window.renderCalendar = date => {
    calendarCurrentDate = new Date(date);
    monthYearSpan.textContent = `${date.toLocaleString('default',{month:'long'})} ${date.getFullYear()}`;
    calendarBody.innerHTML = '';

    let start = new Date(date.getFullYear(), date.getMonth(), 1);
    start.setDate(start.getDate() - start.getDay());

    const today = new Date(); // Dagens datum
    today.setHours(0, 0, 0, 0); // Nollställ tid för jämförelse

    for (let r = 0; r < 6; r++) {
      const tr = document.createElement('tr');
      for (let c = 0; c < 7; c++) {
        const td = document.createElement('td');
        td.className = 'calendar-cell';

        const d = new Date(start);
        d.setDate(start.getDate() + (r * 7 + c));
        d.setHours(0, 0, 0, 0); // Nollställ tid för jämförelse

        // Kontrollera om det är dagens datum
        if (d.getTime() === today.getTime()) {
          td.classList.add('today');
        }
        
        if (d.getMonth() !== date.getMonth()) {
          td.classList.add('other-month');
        }

        const dayDiv = document.createElement('div');
        dayDiv.className = 'day-container';

        const hdr = document.createElement('div');
        hdr.className = 'day-header';
        hdr.textContent = d.getDate();
        hdr.onclick = () => {
          selectedDate = new Date(d);
          displayEventsForDate(d);
        };
        dayDiv.appendChild(hdr);

        const dayEvents = getEventsForDate(d);

        if (dayEvents.length > 0) {
          const indicator = document.createElement('div');
          indicator.className = 'event-indicator';

          const ownEvents = dayEvents.filter(e => !e.is_shared);
          const sharedEvents = dayEvents.filter(e => e.is_shared);

          if (ownEvents.length > 0) {
            indicator.classList.add('has-events');
          }
          if (sharedEvents.length > 0) {
            indicator.classList.add('has-shared-events');
          }

          let tooltipText = '';
          if (ownEvents.length > 0) {
            tooltipText += `${ownEvents.length} event(s)`;
          }
          if (sharedEvents.length > 0) {
            tooltipText += (tooltipText ? ', ' : '') + `${sharedEvents.length} shared event(s)`;
          }

          indicator.title = tooltipText;
          dayDiv.appendChild(indicator);
        }

        const addBtn = document.createElement('div');
        addBtn.className = 'add-event-btn';
        addBtn.textContent = '+';
        addBtn.onclick = e => {
          e.stopPropagation();
          selectedDate = new Date(d);
          addEventModal.style.display = 'block';
        };
        dayDiv.appendChild(addBtn);

        td.appendChild(dayDiv);
        tr.appendChild(td);
      }
      calendarBody.appendChild(tr);
    }
  };

  // ----------- Subject Modal Logic -----------
  const subjectModal = document.getElementById('subject-modal');
  const subjectBtn = document.getElementById('left-subject-btn');
  const subjectClose = subjectModal?.querySelector('.close');
  const subjectForm = document.getElementById('create-subject-form');

  subjectBtn?.addEventListener('click', () => {
    subjectModal.style.display = 'block';
  });

  subjectClose?.addEventListener('click', () => {
    subjectModal.style.display = 'none';
  });

  subjectForm?.addEventListener('submit', e => {
    e.preventDefault();
    subjectModal.style.display = 'none';
  });

  // ----------- Quiz Completion Handling -----------
  window.handleQuizCompletion = function(subject, quizTitle, responses) {
    console.log('[DEBUG] Quiz completion data received:', { subject, quizTitle, responses });

    const submitData = {
      subject: subject,
      quiz_title: quizTitle,
      responses: responses
    };

    console.log('[DEBUG] Submitting data:', submitData);

    return fetch('/submit_ratings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(submitData)
    })
    .then(response => response.json())
    .then(data => {
      console.log('[DEBUG] Response:', data);
      if (data.status === 'success') {
        Swal.fire({
          title: 'Quiz slutfört!',
          text: `Uppdaterade ${data.updated_count} frågor.`,
          icon: 'success',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
        if (data.resolved_subject && data.resolved_topic) {
          console.log(`[DEBUG] Used subject: ${data.resolved_subject}, topic: ${data.resolved_topic}`);
        }
        fetchSchedule().then(() => {
          loadQuizzesForDate();
        });
        return data;
      } else {
        Swal.fire({
          title: 'Fel!',
          text: data.error || 'Unknown error',
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
        throw new Error(data.error || 'Unknown error');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      Swal.fire({
        title: 'Fel!',
        text: 'Network error occurred',
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
      throw error;
    });
  };

  // ----------- Init everything asynchronously -----------
  (async () => {
      console.log('[DEBUG] Initializing application...');
      await fetchSchedule();
      await loadUserSubjects();
      updateDateHeader();
      await loadQuizzesForDate(); // Detta kommer nu också ladda schemat
      await loadEvents();
      
      // Uppdatera aktuell lektion varje minut om vi visar dagens schema
      setInterval(() => {
          const today = new Date();
          if (currentDate.toDateString() === today.toDateString()) {
              markCurrentLesson();
          }
      }, 60000); // Uppdatera varje minut
      
      console.log('[DEBUG] Application initialized successfully');
  })();

  // ----------- Subject Form Handlers -----------
  document.getElementById('create-subject-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = {
      name: formData.get('subject-name'),
      is_shared: formData.get('is-shared') === 'on'
    };
    
    fetch('/add_subject', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'success') {
        Swal.fire({
          title: 'Klart!',
          text: data.message,
          icon: 'success',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        }).then(() => {
          location.reload(); // Reload page to show new subject
        });
      } else {
        Swal.fire({
          title: 'Fel!',
          text: data.message,
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      Swal.fire({
        title: 'Fel!',
        text: 'An error occurred while creating the subject',
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    });
  });

  document.getElementById('join-subject-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = {
      share_code: formData.get('share-code')
    };
    
    fetch('/join_subject', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'success') {
        Swal.fire({
          title: 'Klart!',
          text: data.message,
          icon: 'success',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        }).then(() => {
          location.reload(); // Reload page to show new subject
        });
      } else {
        Swal.fire({
          title: 'Fel!',
          text: data.message,
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      Swal.fire({
        title: 'Fel!',
        text: 'An error occurred while joining the subject',
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    });
  });

  // Prevent event bubbling on delete/leave buttons
  document.querySelectorAll('.delete-subject-btn, .leave-subject-btn').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
    });
  });

  // Ensure subject links work properly
  document.querySelectorAll('.subject-link').forEach(link => {
    link.addEventListener('click', function(e) {
      // Only prevent default if a delete/leave button was clicked
      if (e.target.classList.contains('delete-subject-btn') || 
          e.target.classList.contains('leave-subject-btn')) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
      // Otherwise, let the link work normally
    });
  });

  const subjectSelect = document.getElementById('subject-select');
  const shareOptionGroup = document.getElementById('share-option-group');
  const shareCheckbox = document.getElementById('share-with-members');

  // Visa/dölj sharing option baserat på användarens roll
  subjectSelect?.addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const userRole = selectedOption.getAttribute('data-user-role');
    
    if (userRole === 'owner') {
      shareOptionGroup.style.display = 'block';
    } else {
      shareOptionGroup.style.display = 'none';
      shareCheckbox.checked = false;
    }
  });

}); // End of DOMContentLoaded

// ----------- Additional Functions from index.html -----------

// Function to confirm leaving a subject
async function confirmLeave(subjectName, form) {
  const result = await Swal.fire({
    title: 'Lämna ämne?',
    html: `
      Är du säker på att du vill lämna ämnet "<strong>${subjectName}</strong>"?<br><br>
      <ul style="text-align:left">
        <li>Du kommer inte längre ha tillgång till quiz och flashcards</li>
        <li>Din progress i detta ämne försvinner</li>
        <li>Du kan alltid gå med igen om du har koden</li>
      </ul>
    `,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ja, lämna',
    cancelButtonText: 'Nej, stanna kvar',
    customClass: {
      popup: 'my-swal-popup',
      confirmButton: 'my-confirm-btn',
      cancelButton: 'my-cancel-btn'
    }
  });

  if (!result.isConfirmed) return;

  // For leave buttons, use AJAX instead of form submission
  const formAction = form.action;
  
  try {
    const response = await fetch(formAction, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const data = await response.json();
    
    if (data.status === 'success') {
      await Swal.fire({
        title: 'Klart!',
        text: data.message,
        icon: 'success',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
      // Reload the page to show updated subject list
      window.location.reload();
    } else {
      await Swal.fire({
        title: 'Fel!',
        text: data.message,
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    }
  } catch (error) {
    console.error('Error:', error);
    await Swal.fire({
      title: 'Fel!',
      text: 'An error occurred while leaving the subject',
      icon: 'error',
      customClass: {
        popup: 'my-swal-popup',
        confirmButton: 'my-confirm-btn'
      }
    });
  }
}

// Function to confirm deleting a subject
async function confirmDelete(subjectName, form) {
  const result = await Swal.fire({
    title: 'Ta bort ämne?',
    html: `
      Är du säker på att du vill ta bort ämnet "<strong>${subjectName}</strong>"?<br><br>
      <ul style="text-align:left">
        <li>Alla quiz och flashcards kommer att försvinna</li>
        <li>Alla medlemmar kommer att förlora tillgång</li>
        <li>Denna åtgärd kan inte ångras</li>
      </ul>
    `,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ja, ta bort',
    cancelButtonText: 'Avbryt',
    customClass: {
      popup: 'my-swal-popup',
      confirmButton: 'my-delete-btn',
      cancelButton: 'my-cancel-btn'
    }
  });

  if (result.isConfirmed) {
    form.submit();
  }
}

// Tab functionality for create/join modal
function showTab(tabName) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-button').forEach(button => {
    button.classList.remove('active');
  });
  
  // Show selected tab
  document.getElementById(tabName + '-tab').classList.add('active');
  event.target.classList.add('active');
}

// Handle sharing functionality
async function toggleSharing(subjectId, isCurrentlyShared) {
  try {
    const response = await fetch(`/api/subject/${subjectId}/share`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const data = await response.json();
    
    if (data.status === 'success') {
      await Swal.fire({
        title: 'Klart!',
        text: data.message,
        icon: 'success',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
      location.reload();
    } else {
      await Swal.fire({
        title: 'Fel!',
        text: data.message,
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    }
  } catch (error) {
    console.error('Error:', error);
    await Swal.fire({
      title: 'Fel!',
      text: 'An error occurred while updating sharing settings',
      icon: 'error',
      customClass: {
        popup: 'my-swal-popup',
        confirmButton: 'my-confirm-btn'
      }
    });
  }
}

// Funktion för att ta bort quiz och uppdatera kalender
async function deleteQuizAndRefresh(quizId, subjectName) {
    const result = await Swal.fire({
      title: 'Ta bort quiz?',
      html: `
        Är du säker på att du vill ta bort detta quiz från "<strong>${subjectName}</strong>"?<br><br>
        <ul style="text-align:left">
          <li>Alla frågor och svar kommer att försvinna</li>
          <li>Flashcards för detta quiz tas bort</li>
          <li>Denna åtgärd kan inte ångras</li>
        </ul>
      `,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ja, ta bort',
      cancelButtonText: 'Avbryt',
      customClass: {
        popup: 'my-swal-popup',
        confirmButton: 'my-delete-btn',
        cancelButton: 'my-cancel-btn'
      }
    });

    if (!result.isConfirmed) return;
    
    try {
        const response = await fetch(`/api/quiz/${quizId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            // Visa framgång
            await Swal.fire({
              title: 'Borttaget!',
              text: data.message,
              icon: 'success',
              customClass: {
                popup: 'my-swal-popup',
                confirmButton: 'my-confirm-btn'
              }
            });
            
            // Uppdatera kalendern
            refreshCalendarData();
            
            // Uppdatera aktuell sida om vi är på subject-sidan
            if (window.location.pathname.includes('/subject/')) {
                location.reload();
            }
        } else {
            await Swal.fire({
              title: 'Fel!',
              text: 'Fel vid borttagning: ' + data.message,
              icon: 'error',
              customClass: {
                popup: 'my-swal-popup',
                confirmButton: 'my-confirm-btn'
              }
            });
        }
    } catch (error) {
        console.error('Error:', error);
        await Swal.fire({
          title: 'Fel!',
          text: 'Ett fel uppstod vid borttagning av quiz',
          icon: 'error',
          customClass: {
            popup: 'my-swal-popup',
            confirmButton: 'my-confirm-btn'
          }
        });
    }
}

// Lägg till denna funktion för att uppdatera kalendern
function refreshCalendarData() {
    // Hämta aktuellt datum från kalendern
    const currentDateElement = document.getElementById('current-date');
    if (!currentDateElement) return;
    
    // Uppdatera quiz-data för kalender
    loadQuizzesForDate(getCurrentSelectedDate());
}

function updateQuizzesList(quizzes) {
    const container = document.getElementById('quizzes-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    if (quizzes.length === 0) {
        container.innerHTML = '<p class="no-quizzes">Inga quiz för detta datum</p>';
        return;
    }
    
    quizzes.forEach(quiz => {
        const quizElement = document.createElement('div');
        quizElement.className = 'quiz-item';
        quizElement.innerHTML = `
            <div class="quiz-header">
                <h4>${quiz.title}</h4>
                <span class="quiz-subject">${quiz.subject_name}</span>
            </div>
            <div class="quiz-actions">
                <a href="/quiz/${quiz.id}" class="btn-primary">Ta Quiz</a>
                ${quiz.can_delete ? `<button onclick="deleteQuizAndRefresh(${quiz.id}, '${quiz.subject_name}')" class="btn-delete">Ta bort</button>` : ''}
            </div>
        `;
        container.appendChild(quizElement);
    });
}

function showShareCode(code) {
  document.getElementById('share-code-text').value = code;
  document.getElementById('share-code-modal').style.display = 'block';
}

async function copyShareCode() {
  const shareCodeText = document.getElementById('share-code-text');
  shareCodeText.select();
  try {
    await navigator.clipboard.writeText(shareCodeText.value);
    await Swal.fire({
      title: 'Kopierat!',
      text: 'Share code copied to clipboard!',
      icon: 'success',
      timer: 1500,
      showConfirmButton: false,
      customClass: {
        popup: 'my-swal-popup'
      }
    });
  } catch (err) {
    // Fallback for older browsers
    document.execCommand('copy');
    await Swal.fire({
      title: 'Kopierat!',
      text: 'Share code copied to clipboard!',
      icon: 'success',
      timer: 1500,
      showConfirmButton: false,
      customClass: {
        popup: 'my-swal-popup'
      }
    });
  }
}

async function leaveSubject(subjectId) {
  const result = await Swal.fire({
    title: 'Lämna ämne?',
    html: `
      Är du säker på att du vill lämna detta ämne?<br><br>
      <ul style="text-align:left">
        <li>Du kommer inte längre ha tillgång till quiz och flashcards</li>
        <li>Din progress i detta ämne försvinner</li>
        <li>Du kan alltid gå med igen om du har koden</li>
      </ul>
    `,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ja, lämna',
    cancelButtonText: 'Nej, stanna kvar',
    customClass: {
      popup: 'my-swal-popup',
      confirmButton: 'my-confirm-btn',
      cancelButton: 'my-cancel-btn'
    }
  });

  if (!result.isConfirmed) return;

  try {
    const response = await fetch(`/leave_subject/${subjectId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    });
    
    const data = await response.json();
    
    if (data.status === 'success') {
      await Swal.fire({
        title: 'Klart!',
        text: data.message,
        icon: 'success',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
      // Redirect to index page
      if (data.redirect) {
        window.location.href = data.redirect;
      } else {
        window.location.href = '/';
      }
    } else {
      await Swal.fire({
        title: 'Fel!',
        text: data.message,
        icon: 'error',
        customClass: {
          popup: 'my-swal-popup',
          confirmButton: 'my-confirm-btn'
        }
      });
    }
  } catch (error) {
    console.error('Error:', error);
    await Swal.fire({
      title: 'Fel!',
      text: 'An error occurred while leaving the subject',
      icon: 'error',
      customClass: {
        popup: 'my-swal-popup',
        confirmButton: 'my-confirm-btn'
      }
    });
  }
}
</script>




  <style>
      /* === GLOBAL RESET & VARIABLES === */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-color: #2563eb;
        --primary-hover: #1d4ed8;
        --secondary-color: #f1f5f9;
        --accent-color: #059669;
        --danger-color: #dc2626;
        --warning-color: #d97706;
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --text-muted: #64748b;
        --border-color: #e2e8f0;
        --bg-white: #ffffff;
        --bg-gray-50: #f8fafc;
        --bg-gray-100: #f1f5f9;
        --bg-gray-200: #e2e8f0;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-2xl: 1.5rem;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background-color: var(--bg-white);
        color: var(--text-primary);
        line-height: 1.6;
      }

      /* === HEADER SECTION === */
      #top {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 70px;
        background: var(--bg-white);
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
      }

      #first-words {
        margin-right: 8px;
        font-size: 1.75rem;
        color: var(--text-secondary);
        font-weight: 300;
      }

      #second-words {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--primary-color);
        letter-spacing: -0.025em;
      }

      .header-container {
        height: 70px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2rem;
        background-color: var(--bg-white);
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
      }

      .user_icon,
      .question {
        width: 2rem;
        height: 2rem;
        stroke: var(--text-secondary);
        transition: all 0.2s ease;
        cursor: pointer;
        border-radius: var(--radius-lg);
        padding: 0.25rem;
      }

      .user_icon:hover,
      .question:hover {
        stroke: var(--primary-color);
        background-color: var(--bg-gray-50);
        transform: translateY(-1px);
      }

      .head-btn, .logout-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: var(--radius-lg);
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .head-btn {
        background-color: var(--primary-color);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .head-btn:hover {
        background-color: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .logout-btn {
        background-color: var(--bg-white);
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
      }

      .logout-btn:hover {
        background-color: var(--danger-color);
        color: white;
        border-color: var(--danger-color);
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
      }

      /* === FLASH MESSAGES === */
      .flash-messages-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 9999;
        max-width: 400px;
      }

      .flash-message {
        padding: 1rem 2.5rem 1rem 1rem;
        margin-bottom: 0.5rem;
        border-radius: var(--radius-lg);
        font-weight: 500;
        position: relative;
        box-shadow: var(--shadow-lg);
        animation: slideIn 0.3s ease-out;
        backdrop-filter: blur(8px);
      }

      .flash-success {
        background-color: rgba(240, 253, 244, 0.9);
        color: #166534;
        border: 1px solid #bbf7d0;
      }

      .flash-error {
        background-color: rgba(254, 242, 242, 0.9);
        color: #991b1b;
        border: 1px solid #fecaca;
      }

      .flash-close {
        position: absolute;
        top: 0.5rem;
        right: 0.75rem;
        background: none;
        border: none;
        font-size: 1.125rem;
        cursor: pointer;
        color: inherit;
        opacity: 0.7;
        transition: opacity 0.2s ease;
      }

      .flash-close:hover {
        opacity: 1;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* === MAIN LAYOUT === */
      .center-container {
        display: grid;
        grid-template-columns: 380px 1fr;
        grid-template-rows: 1fr auto;
        height: calc(100vh - 140px);
        gap: 0;
      }

      /* === LEFT CONTAINER (SUBJECTS) === */
      .left-container {
        background-color: var(--bg-white);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }

      .left-btn-container {
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-bottom: 1px solid var(--border-color);
        background-color: var(--bg-gray-50);
      }

      #left-subject-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-lg);
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.025em;
        box-shadow: var(--shadow-sm);
      }

      #left-subject-btn:hover {
        background-color: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      #subject-header {
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--text-primary);
        padding: 1.25rem 1.5rem 1rem;
        background-color: var(--bg-white);
      }

      .subject-list {
        flex: 1;
        padding: 1rem 1.5rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        background-color: var(--bg-white);
      }

      .subject-list::-webkit-scrollbar {
        width: 6px;
      }

      .subject-list::-webkit-scrollbar-track {
        background: var(--bg-gray-100);
        border-radius: var(--radius-sm);
      }

      .subject-list::-webkit-scrollbar-thumb {
        background: var(--text-muted);
        border-radius: var(--radius-sm);
      }

      .subject {
        position: relative;
      }

      .subject-link {
        text-decoration: none;
        color: inherit;
        display: block;
      }

      .subject-button {
        width: 100%;
        padding: 1.25rem 3rem 1.25rem 1.25rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-xl);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.2s ease;
        text-align: left;
        background: var(--bg-white);
        box-shadow: var(--shadow-sm);
      }

      .subject-button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary-color);
      }

      .subject-button.owned {
        background: linear-gradient(135deg, var(--bg-white) 0%, #f0fdf4 100%);
        border-left: 4px solid var(--accent-color);
      }

      .subject-button.shared {
        background: linear-gradient(135deg, var(--bg-white) 0%, #eff6ff 100%);
        border-left: 4px solid var(--primary-color);
      }

      .subject-title {
        font-weight: 600;
        color: var(--text-primary);
        flex-grow: 1;
      }

      .subject-badges {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .subject-role-badge {
        font-size: 0.75rem;
        background-color: var(--bg-gray-100);
        color: var(--text-secondary);
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        font-weight: 500;
      }

      .owned .subject-role-badge {
        background-color: #dcfce7;
        color: #166534;
      }

      .shared .subject-role-badge {
        background-color: #dbeafe;
        color: #2563eb;
      }

      .due-badge {
        background-color: var(--primary-color);
        color: white;
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        min-width: 1.5rem;
        text-align: center;
      }

      .delete-subject-btn,
      .leave-subject-btn {
        position: absolute;
        top: 50%;
        right: 0.75rem;
        transform: translateY(-50%);
        background-color: var(--bg-white);
        color: var(--danger-color);
        border: 1px solid var(--border-color);
        border-radius: 50%;
        width: 2rem;
        height: 2rem;
        font-size: 0.875rem;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }

      .delete-subject-btn:hover,
      .leave-subject-btn:hover {
        background-color: var(--danger-color);
        color: white;
        transform: translateY(-50%) scale(1.1);
        box-shadow: var(--shadow-md);
      }

      .leave-subject-btn {
        color: var(--warning-color);
      }

      .leave-subject-btn:hover {
        background-color: var(--warning-color);
      }

      .no-subjects-message {
        text-align: center;
        padding: 2rem 1.5rem;
        color: var(--text-muted);
        font-style: italic;
        background-color: var(--bg-gray-50);
        border-radius: var(--radius-xl);
        border: 2px dashed var(--border-color);
      }

      /* === RIGHT CONTAINER (QUIZ CALENDAR) === */
      .right-container {
        background-color: var(--bg-gray-50);
        display: flex;
        flex-direction: column;
      }



      .right-content-wrapper {
        flex: 1;
        display: grid;
        grid-template-columns: 300px 1fr;
        height: 100%;
        min-height: 0;
      }

      /* === SCHEDULE CONTAINER === */
      .schedule-container {
        background-color: var(--bg-white);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .schedule-header {
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--text-primary);
        padding: 1.25rem 1.5rem 1rem;
        background-color: var(--bg-white);
        border-bottom: 1px solid var(--border-color);
        margin: 0;
      }

      .schedule-content {
        flex: 1;
        padding: 1.5rem;
        overflow-y: auto;
        background-color: var(--bg-white);
      }

      .schedule-content::-webkit-scrollbar {
        width: 6px;
      }

      .schedule-content::-webkit-scrollbar-track {
        background: var(--bg-gray-100);
        border-radius: var(--radius-sm);
      }

      .schedule-content::-webkit-scrollbar-thumb {
        background: var(--text-muted);
        border-radius: var(--radius-sm);
      }

      .no-schedule {
        text-align: center;
        color: var(--text-muted);
        font-style: italic;
        padding: 2rem 1rem;
      }

      .right-quiz-btn-container {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 70px;
        background-color: var(--bg-white);
        border-bottom: 1px solid var(--border-color);
      }

      #right-quiz-btn {
        height: 3rem;
        border-radius: var(--radius-lg);
        padding: 0 2rem;
        font-weight: 700;
        font-size: 1rem;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.025em;
        box-shadow: var(--shadow-sm);
      }

      #right-quiz-btn:hover {
        background-color: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }


      /* Lägg till denna CSS i din index_styles.css fil */
      .assignment-badge {
        background-color: var(--danger-color);
        color: white;
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        min-width: 1.5rem;
        text-align: center;
      }

      .products-header {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1.25rem;
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--text-primary);
        background-color: var(--bg-white);
        border-bottom: 1px solid var(--border-color);
        gap: 1rem;
      }

      #prev-day-btn,
      #next-day-btn {
        background-color: var(--bg-white);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 0.5rem 0.75rem;
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }

      #prev-day-btn:hover,
      #next-day-btn:hover {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      #current-date {
        color: var(--text-primary);
        font-weight: 600;
        min-width: 200px;
        text-align: center;
      }

      .products-container {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        grid-auto-rows: min-content;
        gap: 1.5rem;
        padding: 2rem;
        overflow-y: auto;
        background: var(--bg-gray-50);
      }

      .products-container::-webkit-scrollbar {
        width: 8px;
      }

      .products-container::-webkit-scrollbar-track {
        background: var(--bg-gray-100);
        border-radius: var(--radius-sm);
      }

      .products-container::-webkit-scrollbar-thumb {
        background: var(--text-muted);
        border-radius: var(--radius-sm);
      }

      /* === QUIZ CARDS === */
      .quiz-card {
        background: var(--bg-white);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-sm);
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .quiz-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
      }

      .quiz-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
        border-color: var(--primary-color);
      }

      .quiz-card h3 {
        margin: 0 0 0.75rem 0;
        color: var(--text-primary);
        font-size: 1.25rem;
        font-weight: 700;
        line-height: 1.4;
      }

      .quiz-card p {
        margin: 0 0 1.5rem 0;
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
      }

      .quiz-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
        flex-direction: row; 
      }

      

      .leave-quiz-btn {
        font-size: 1.2rem;
        padding: 0.5rem 0.75rem;
        line-height: 1;
      }

      .start-quiz-btn {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--shadow-sm);
      }

      .start-quiz-btn:hover {
        background-color: #047857;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      #leave-quiz-btn {
        width: 40px;
        height: 40px;
        justify-content: center;
      }

      .leave-quiz-btn {
        background: var(--danger-color);
        color: white;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: var(--shadow-sm);
      }

      .leave-quiz-btn:hover {
        background-color: #b91c1c;
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      /* === BOTTOM SECTION === */
      .bottom {
        grid-column: 1/3;
        background-color: var(--bg-gray-50);
        border-top: 1px solid var(--border-color);
        padding: 1rem;
        color: var(--text-muted);
        text-align: center;
        font-size: 0.875rem;
      }

      /* === MODAL STYLES === */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        display: none;
        z-index: 1000;
        overflow: auto;
        backdrop-filter: blur(4px);
      }

      .modal-content {
        background-color: var(--bg-white);
        margin: 5% auto;
        padding: 2.5rem;
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-xl);
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        border: 1px solid var(--border-color);
      }

      .close {
        color: var(--text-muted);
        font-size: 1.5rem;
        font-weight: bold;
        position: absolute;
        right: 1.25rem;
        top: 1.25rem;
        cursor: pointer;
        transition: all 0.2s ease;
        background: none;
        border: none;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .close:hover {
        color: var(--text-primary);
        background-color: var(--bg-gray-100);
      }

      /* === CALENDAR MODAL === */
      .calendar-content {
        max-width: 90%;
        max-height: 85vh;
        margin: 2% auto;
        position: relative;
        background-color: var(--bg-white);
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-xl);
        padding: 2.5rem;
        border: 1px solid var(--border-color);
        overflow: hidden; /* Lägg till denna för att förhindra överflöde */
        display: flex; /* Ändra till flex */
        flex-direction: column; /* Ställ in column-riktning */
      }

      .calendar-main-container {
        flex: 1; /* Ta upp återstående utrymme */
        min-height: 0; /* Viktigt för flex-shrinking */
        overflow: hidden; /* Förhindra överflöde */
        display: flex;
        flex-direction: column;
      }


      .calendar-close {
        position: absolute;
        top: 1.25rem;
        right: 1.25rem;
        color: var(--text-muted);
        font-size: 1.75rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease;
        background: none;
        border: none;
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .calendar-close:hover {
        color: var(--text-primary);
        background-color: var(--bg-gray-100);
      }

      .calendar-header {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }






      /* Lägg till dessa CSS-stilar i din befintliga CSS-fil */

      /* Schema container */
      .schedule-container {
          background: white;
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          border: 1px solid #e1e5e9;
      }

      .schedule-header {
          color: #2c3e50;
          font-size: 1.4rem;
          font-weight: 600;
          margin: 0 0 15px 0;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      .schedule-header::before {
          
          font-size: 1.2rem;
      }

      /* Schema datum info */
      .schedule-date-info {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 15px;
          font-weight: 500;
      }

      .class-info {
          font-size: 0.9rem;
          opacity: 0.9;
          font-weight: normal;
      }

      /* Schema lektioner */
      .schedule-lessons {
          display: flex;
          flex-direction: column;
          gap: 10px;
      }

      .schedule-item {
          display: flex;
          align-items: center;
          padding: 12px 16px;
          background: #f8f9fa;
          border-radius: 8px;
          border-left: 4px solid #3498db;
          transition: all 0.3s ease;
      }

      .schedule-item:hover {
          background: #e3f2fd;
          border-left-color: #2196F3;
          transform: translateX(2px);
      }

      .schedule-time {
          display: flex;
          align-items: center;
          min-width: 100px;
          font-weight: 600;
          color: #2c3e50;
          font-size: 0.95rem;
      }

      .time-separator {
          margin: 0 5px;
          color: #7f8c8d;
      }

      .schedule-details {
          flex: 1;
          margin-left: 16px;
      }

      .schedule-subject {
          font-weight: 600;
          color: #2c3e50;
          font-size: 1rem;
          margin-bottom: 2px;
      }

      .schedule-room {
          color: #7f8c8d;
          font-size: 0.9rem;
          font-weight: 400;
      }

      .schedule-room::before {
          
          margin-right: 2px;
      }

      /* Inget schema meddelande */
      .no-schedule {
          text-align: center;
          padding: 30px 20px;
          color: #7f8c8d;
          font-style: italic;
      }

      .no-schedule p {
          margin: 0;
          font-size: 1rem;
      }

      /* Schema fel meddelande */
      .schedule-error {
          text-align: center;
          padding: 20px;
          background: #fff5f5;
          border: 1px solid #fed7d7;
          border-radius: 8px;
          color: #c53030;
      }

      .schedule-error p {
          margin: 0;
          font-size: 0.95rem;
      }

      /* Responsiv design för schema */
      @media (max-width: 768px) {
          .schedule-container {
              padding: 15px;
              margin-bottom: 15px;
          }
          
          .schedule-item {
              flex-direction: column;
              align-items: flex-start;
              padding: 12px;
          }
          
          .schedule-time {
              min-width: auto;
              margin-bottom: 8px;
          }
          
          .schedule-details {
              margin-left: 0;
              width: 100%;
          }
          
          .schedule-header {
              font-size: 1.2rem;
          }
      }

      /* Schema indikator för dagens lektion */
      .schedule-item.current-lesson {
          border-left-color: #e74c3c;
          background: linear-gradient(90deg, #fff5f5 0%, #f8f9fa 100%);
      }

      .schedule-item.current-lesson .schedule-time {
          color: #e74c3c;
      }

      .schedule-item.current-lesson .schedule-subject {
          color: #e74c3c;
      }/* Lägg till dessa CSS-stilar i din befintliga CSS-fil */

      /* Schema container */
      .schedule-container {
          background: white;
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          border: 1px solid #e1e5e9;
      }

      .schedule-header {
          color: #2c3e50;
          font-size: 1.4rem;
          font-weight: 600;
          margin: 0 0 15px 0;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      .schedule-header::before {
          
          font-size: 1.2rem;
      }

      /* Schema datum info */
      .schedule-date-info {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 15px;
          font-weight: 500;
      }

      .class-info {
          font-size: 0.9rem;
          opacity: 0.9;
          font-weight: normal;
      }

      /* Schema lektioner */
      .schedule-lessons {
          display: flex;
          flex-direction: column;
          gap: 10px;
      }

      .schedule-item {
          display: flex;
          align-items: center;
          padding: 12px 16px;
          background: #f8f9fa;
          border-radius: 8px;
          border-left: 4px solid #3498db;
          transition: all 0.3s ease;
      }

      .schedule-item:hover {
          background: #e3f2fd;
          border-left-color: #2196F3;
          transform: translateX(2px);
      }

      .schedule-time {
          display: flex;
          align-items: center;
          min-width: 100px;
          font-weight: 600;
          color: #2c3e50;
          font-size: 0.95rem;
      }

      .time-separator {
          margin: 0 5px;
          color: #7f8c8d;
      }

      .schedule-details {
          flex: 1;
          margin-left: 16px;
      }

      .schedule-subject {
          font-weight: 600;
          color: #2c3e50;
          font-size: 1rem;
          margin-bottom: 2px;
      }

      .schedule-room {
          color: #7f8c8d;
          font-size: 0.9rem;
          font-weight: 400;
      }

      .schedule-room::before {
         
          margin-right: 2px;
      }

      /* Inget schema meddelande */
      .no-schedule {
          text-align: center;
          padding: 30px 20px;
          color: #7f8c8d;
          font-style: italic;
      }

      .no-schedule p {
          margin: 0;
          font-size: 1rem;
      }

      /* Schema fel meddelande */
      .schedule-error {
          text-align: center;
          padding: 20px;
          background: #fff5f5;
          border: 1px solid #fed7d7;
          border-radius: 8px;
          color: #c53030;
      }

      .schedule-error p {
          margin: 0;
          font-size: 0.95rem;
      }

      /* Responsiv design för schema */
      @media (max-width: 768px) {
          .schedule-container {
              padding: 15px;
              margin-bottom: 15px;
          }
          
          .schedule-item {
              flex-direction: column;
              align-items: flex-start;
              padding: 12px;
          }
          
          .schedule-time {
              min-width: auto;
              margin-bottom: 8px;
          }
          
          .schedule-details {
              margin-left: 0;
              width: 100%;
          }
          
          .schedule-header {
              font-size: 1.2rem;
          }
      }

      /* Schema indikator för dagens lektion */
      .schedule-item.current-lesson {
          border-left-color: #e74c3c;
          background: linear-gradient(90deg, #fff5f5 0%, #f8f9fa 100%);
      }

      .schedule-item.current-lesson .schedule-time {
          color: #e74c3c;
      }

      .schedule-item.current-lesson .schedule-subject {
          color: #e74c3c;
      }

      #prev-month-btn,
      #next-month-btn {
        cursor: pointer;
        font-size: 1.125rem;
        padding: 0.75rem 1rem;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
        background-color: var(--bg-white);
        color: var(--text-secondary);
        transition: all 0.2s ease;
        font-weight: 600;
        box-shadow: var(--shadow-sm);
      }

      #prev-month-btn:hover,
      #next-month-btn:hover {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      #month-year {
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--text-primary);
      }

      #calendar-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        font-size: 0.875rem;
        border-radius: var(--radius-xl);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        flex-shrink: 0; /* Förhindra att tabellen krymper för mycket */
      }

      /* Begränsa cellhöjden för fullscreen */
      #calendar-table td {
        border: 1px solid var(--border-color);
        padding: 0.5rem; /* Minska padding från 0.75rem */
        height: 80px; /* Fast höjd istället för 90px */
        max-height: 80px; /* Begränsa maxhöjd */
        vertical-align: top;
        background-color: var(--bg-white);
        transition: all 0.2s ease;
        overflow: hidden; /* Dölj överflöde i celler */
      }

      #calendar-table td {
        border: 1px solid var(--border-color);
        padding: 0.75rem;
        height: 90px;
        vertical-align: top;
        background-color: var(--bg-white);
        transition: all 0.2s ease;
      }

      .calendar-cell:hover {
        background-color: var(--bg-gray-50);
        cursor: pointer;
      }

      .calendar-cell.today .day-header {
        background-color: gold;
        color: white;
        border-radius: var(--radius-md);
        font-weight: 700;
      }

      .calendar-cell.today {
        background-color: #dbeafe;
        border: 2px solid var(--primary-color);
        position: relative;
      }

      

      .calendar-cell.other-month {
        color: var(--text-muted);
        background-color: var(--bg-gray-50);
      }

      .day-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .day-header {
        font-weight: 600;
        font-size: 0.875rem;
        padding: 0.25rem 0.5rem;
        text-align: left;
        cursor: pointer;
        border-radius: var(--radius-sm);
        transition: background-color 0.2s;
      }

      .day-header:hover {
        background-color: var(--bg-gray-100);
      }

      .event-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0.25rem 0;
        padding: 0.25rem 0.5rem;
        background-color: var(--primary-color);
        color: white;
        border-radius: var(--radius-md);
        font-size: 0.625rem;
        font-weight: 500;
        gap: 0.25rem;
      }

      .event-indicator.has-shared-events {
        background-color: var(--accent-color);
      }

      .event-indicator.has-repetitions {
        background-color: var(--warning-color);
      }

      .add-event-btn {
        position: absolute;
        bottom: 0.25rem;
        right: 0.25rem;
        width: 1.5rem;
        height: 1.5rem;
        border: none;
        background-color: var(--accent-color);
        color: white;
        border-radius: 50%;
        font-size: 0.875rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }

      .calendar-cell:hover .add-event-btn {
        opacity: 1;
      }

      .add-event-btn:hover {
        background-color: #047857;
        transform: scale(1.1);
        box-shadow: var(--shadow-md);
      }

      /* === EVENTS DISPLAY === */
      .events-display {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        background: var(--bg-white);
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-xl);
        z-index: 1002;
        display: none;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .events-header {
        padding: 1.5rem;
        background: var(--bg-gray-50);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .events-header h3 {
        margin: 0;
        font-size: 1.25rem;
        color: var(--text-primary);
        font-weight: 700;
      }

      .close-events-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-muted);
        padding: 0.25rem;
        border-radius: 50%;
        transition: all 0.2s ease;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-events-btn:hover {
        background-color: var(--bg-gray-100);
        color: var(--text-primary);
      }

      .events-list {
        padding: 1.5rem;
        overflow-y: auto;
        flex-grow: 1;
      }

      .event-item {
        background: var(--bg-white);
        border-radius: var(--radius-xl);
        padding: 1.25rem;
        margin-bottom: 1rem;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }

      .event-item:hover {
        border-color: var(--primary-color);
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }

      .event-item.shared-event {
        border-left: 4px solid var(--accent-color);
      }

      .event-item.private-event {
        border-left: 4px solid var(--primary-color);
      }

      .event-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
      }

      .event-header h4 {
        margin: 0;
        font-size: 1.125rem;
        color: var(--text-primary);
        font-weight: 600;
      }

      .event-badges {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }

      .test-type-badge {
        font-size: 0.625rem;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        text-transform: uppercase;
        background-color: var(--primary-color);
        color: white;
      }

      .shared-badge {
        font-size: 0.625rem;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        text-transform: uppercase;
        background-color: var(--accent-color);
        color: white;
      }

      .event-details {
        margin-top: 0.75rem;
      }

      .event-details p {
        margin: 0.25rem 0;
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.5;
      }

      .event-actions {
        margin-top: 1rem;
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
      }

      .delete-btn, .share-btn {
        background: var(--danger-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: var(--radius-lg);
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 600;
        box-shadow: var(--shadow-sm);
      }

      .share-btn {
        background: var(--primary-color);
      }

      .delete-btn:hover {
        background: #b91c1c;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .share-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .no-events {
        text-align: center;
        padding: 3rem;
        color: var(--text-muted);
      }

      .no-events p {
        margin-bottom: 1rem;
        font-style: italic;
        font-size: 1rem;
      }

      /* === ADD EVENT MODAL === */
      .modal-a {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 500px;
        background: var(--bg-white);
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-xl);
        z-index: 1001;
        padding: 2.5rem;
        display: none;
        max-height: 80vh;
        overflow-y: auto;
        border: 1px solid var(--border-color);
      }

      #add-event-modal-close {
        position: absolute;
        top: 1.25rem;
        right: 1.25rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-muted);
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
      }

      #add-event-modal-close:hover {
        background-color: var(--bg-gray-100);
        color: var(--text-primary);
      }

      #add-event-title {
        margin-bottom: 2rem;
        color: var(--text-primary);
        font-weight: 700;
        font-size: 1.5rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.875rem;
      }

      .subject-select,
      .test-type-select,
      #event-title,
      #event-description {
        width: 100%;
        padding: 0.875rem;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        font-size: 0.875rem;
        background-color: var(--bg-white);
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .subject-select:focus,
      .test-type-select:focus,
      #event-title:focus,
      #event-description:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      #event-description {
        resize: vertical;
        min-height: 100px;
      }

      .checkbox-label {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        font-size: 0.875rem;
        color: var(--text-primary);
        cursor: pointer;
        line-height: 1.5;
      }

      .checkbox-label input[type="checkbox"] {
        margin-top: 0.125rem;
        width: 1rem;
        height: 1rem;
      }

      .checkbox-info {
        display: block;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.5rem;
      }

      .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border-color);
      }

      .save-btn, .cancel-btn {
        padding: 0.875rem 1.75rem;
        border-radius: var(--radius-lg);
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
      }

      .save-btn {
        background: var(--primary-color);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .save-btn:hover {
        background-color: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .cancel-btn {
        background: var(--bg-gray-100);
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
      }

      .cancel-btn:hover {
        background: var(--bg-gray-200);
        color: var(--text-primary);
        transform: translateY(-1px);
      }

      /* === SUBJECT MODAL === */
      .create-subject-section {
        margin-top: 1.5rem;
      }

      .create-subject-tabs {
        display: flex;
        margin-bottom: 1.5rem;
        border-radius: var(--radius-xl);
        overflow: hidden;
        background-color: var(--bg-gray-100);
      }

      .tab-button {
        flex: 1;
        padding: 1rem 1.5rem;
        background-color: transparent;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: var(--text-secondary);
        transition: all 0.2s ease;
      }

      .tab-button.active {
        background-color: var(--primary-color);
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .tab-content form {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }

      .tab-content button[type="submit"] {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.875rem 2rem;
        border-radius: var(--radius-lg);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-top: 1rem;
        box-shadow: var(--shadow-sm);
      }

      .tab-content button[type="submit"]:hover {
        background-color: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      /* === SHARE CODE MODAL === */
      .share-code-display {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-top: 1.5rem;
      }

      .share-code-display input {
        flex: 1;
        padding: 1rem;
        font-size: 1.125rem;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        background-color: var(--bg-gray-50);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        text-align: center;
        font-weight: 600;
        letter-spacing: 0.1em;
        color: var(--text-primary);
      }

      .share-code-display input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .share-code-display button {
        padding: 1rem 1.5rem;
        background-color: var(--accent-color);
        color: white;
        border: none;
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
      }

      .share-code-display button:hover {
        background-color: #047857;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      /* === SWEETALERT2 CUSTOM STYLING === */
      .my-swal-popup {
        border-radius: var(--radius-2xl);
        font-family: inherit;
        border: 1px solid var(--border-color);
      }

      .my-confirm-btn {
        background-color: var(--primary-color);
        color: white;
        border-radius: var(--radius-lg);
        padding: 0.875rem 1.75rem;
        font-weight: 600;
        border: none;
      }

      .my-cancel-btn {
        color: var(--text-secondary);
        background-color: var(--bg-gray-100);
        border-radius: var(--radius-lg);
        padding: 0.875rem 1.75rem;
        font-weight: 600;
        border: 1px solid var(--border-color);
      }

      .my-delete-btn {
        background-color: var(--danger-color);
        color: white;
        border-radius: var(--radius-lg);
        padding: 0.875rem 1.75rem;
        font-weight: 600;
        border: none;
      }

      @media (min-height: 900px) {
        #calendar-table td {
          height: 100px;
          max-height: 100px;
        }
      }

      @media (max-height: 700px) {
        .calendar-content {
          max-height: 95vh;
          padding: 1.5rem;
        }
        
        #calendar-table td {
          height: 60px;
          max-height: 60px;
          padding: 0.25rem;
        }
      }

      /* === RESPONSIVE DESIGN === */
      @media (max-width: 1200px) {
        .center-container {
          grid-template-columns: 350px 1fr;
        }
      }

      @media (max-width: 1200px) {
        .right-content-wrapper {
          grid-template-columns: 280px 1fr;
        }
      }

      @media (max-width: 1024px) {
        .right-content-wrapper {
          grid-template-columns: 250px 1fr;
        }
      }

      @media (max-width: 1024px) {
        .center-container {
          grid-template-columns: 300px 1fr;
        }

        .products-container {
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 1.25rem;
          padding: 1.5rem;
        }
      }

      @media (max-width: 768px) {
        .right-content-wrapper {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr;
        }
        
        .schedule-container {
          border-right: none;
          border-bottom: 1px solid var(--border-color);
          max-height: 800px; /* Ökat från 300px till 450px */
        }
        
        .schedule-content {
          padding: 1rem;
        }
        
        .products-container {
          padding: 1.25rem;
        }
      }

      @media (max-width: 480px) {
        .schedule-content {
          padding: 0.75rem;
        }
        
        .schedule-header {
          padding: 1rem 1.25rem 0.75rem;
          font-size: 1rem;
        }
      }


      @media (max-width: 768px) {
        .center-container {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr auto;
        }

        .left-container {
          border-right: none;
          border-bottom: 1px solid var(--border-color);
        }

        .header-container {
          padding: 0 1rem;
        }

        .head-btn, .logout-btn {
          padding: 0.625rem 1.25rem;
          font-size: 0.8125rem;
        }

        .products-container {
          grid-template-columns: 1fr;
          padding: 1.25rem;
          gap: 1rem;
        }

        .quiz-actions {
          flex-direction: column;
        }

        .start-quiz-btn {
          width: 100%;
          justify-content: center;
        }

        .modal-content,
        .modal-a,
        .calendar-content {
          width: 95%;
          margin: 5% auto;
          padding: 2rem;
        }

        .events-display {
          width: 95%;
          max-height: 90vh;
        }

        #calendar-table td {
          height: 70px;
          padding: 0.5rem;
        }

        .day-header {
          font-size: 0.8125rem;
        }

        .event-indicator {
          font-size: 0.625rem;
          padding: 0.25rem;
        }
      }

      @media (max-width: 480px) {
        .header-container {
          height: 60px;
          padding: 0 0.75rem;
        }

        .user_icon,
        .question {
          width: 1.75rem;
          height: 1.75rem;
        }

        #first-words {
          font-size: 1.25rem;
        }

        #second-words {
          font-size: 1.5rem;
        }

        .subject-list {
          padding: 1rem;
        }

        .subject-button {
          padding: 1rem 2.5rem 1rem 1rem;
          font-size: 0.8125rem;
        }

        .products-container {
          padding: 1rem;
          gap: 1rem;
        }

        .quiz-card {
          padding: 1.25rem;
        }

        .quiz-card h3 {
          font-size: 1.125rem;
        }

        .modal-content,
        .modal-a,
        .calendar-content {
          padding: 1.5rem;
        }

        #calendar-table td {
          height: 60px;
          padding: 0.25rem;
        }

        .event-indicator {
          font-size: 0.5rem;
        }
      }

      /* === PRINT STYLES === */
      @media print {
        .header-container,
        .left-btn-container,
        .right-quiz-btn-container,
        .flash-messages-container,
        .modal,
        .modal-a {
          display: none !important;
        }

        body {
          background: white;
          color: black;
        }

        .quiz-card {
          break-inside: avoid;
          box-shadow: none;
          border: 1px solid #ccc;
        }
      }
  </style>
</body>
</html>
