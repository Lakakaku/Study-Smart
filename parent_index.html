<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F√∂r√§ldrasida - {{ child.first_name }} {{ child.last_name }}</title>
    <style>
        :root {
            --primary-color: #4299e1;
            --secondary-color: #667eea;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --light-gray: #f7fafc;
            --medium-gray: #e2e8f0;
            --dark-gray: #4a5568;
            --text-color: #2d3748;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-gray);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .child-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .child-avatar {
            width: 80px;
            height: 80px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .child-details h2 {
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .child-details p {
            color: var(--dark-gray);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .date-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-selector label {
            font-weight: 500;
            color: var(--dark-gray);
        }

        .date-selector input,
        .date-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--medium-gray);
            border-radius: 6px;
            font-size: 1rem;
        }

        .schedule-day {
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .day-header {
            background: var(--light-gray);
            padding: 1rem;
            font-weight: bold;
            color: var(--text-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lesson {
            padding: 1rem;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .lesson:last-child {
            border-bottom: none;
        }

        .lesson:hover {
            background: var(--light-gray);
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-time {
            font-weight: bold;
            color: var(--primary-color);
        }

        .lesson-subject {
            font-size: 1.1rem;
            margin: 0.25rem 0;
        }

        .lesson-room {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .absence-btn {
            background: var(--warning-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .absence-btn:hover {
            background: #dd7200;
        }

        .absence-btn.reported {
            background: var(--danger-color);
        }

        .absence-btn.reported:hover {
            background: #e53e3e;
        }

        .absence-form {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .absence-form h4 {
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--medium-gray);
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            height: 80px;
        }

        .form-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-secondary {
            background: var(--medium-gray);
            color: var(--dark-gray);
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .absence-reports {
            margin-top: 1rem;
        }

        .absence-item {
            background: #fef5e7;
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0 6px 6px 0;
        }

        .absence-item.approved {
            background: #f0fff4;
            border-left-color: var(--success-color);
        }

        .absence-item.denied {
            background: #fed7d7;
            border-left-color: var(--danger-color);
        }

        .absence-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef5e7;
            color: #dd7200;
        }

        .status-approved {
            background: #f0fff4;
            color: #22543d;
        }

        .status-denied {
            background: #fed7d7;
            color: #c53030;
        }

        .no-schedule {
            text-align: center;
            padding: 2rem;
            color: var(--dark-gray);
        }

        .no-schedule svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            color: var(--medium-gray);
        }

        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            background: #e53e3e;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .child-info {
                flex-direction: column;
                gap: 1rem;
            }

            .date-selector {
                flex-direction: column;
                align-items: flex-start;
            }

            .lesson {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .form-buttons {
                flex-direction: column;
            }
        }

        .flash-messages {
            margin-bottom: 2rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #f0fff4;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .alert-danger {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .alert-info {
            background: #ebf8ff;
            color: #2a69ac;
            border: 1px solid #90cdf4;
        }
    </style>
</head>
<body>
    <form method="POST" action="{{ url_for('logout') }}" style="display: inline;">
        <button type="submit" class="logout-btn">LOGGA UT</button>
      </form>


    <div class="container">
        <div class="header">
            <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ F√∂r√§ldrasida</h1>
            <div class="child-info">
                <div class="child-avatar">
                    {{ child.first_name[0] }}{{ child.last_name[0] }}
                </div>
                <div class="child-details">
                    <h2>{{ child.first_name }} {{ child.last_name }}</h2>
                    <p>{{ child.get_class_name() }} ‚Ä¢ {{ child.get_school_name() }}</p>
                </div>
            </div>
        </div>

        <div class="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <div class="main-content">
            <!-- Schema sektion -->
            <div class="section">
                <h3>üìÖ Schema</h3>
                
                <div class="date-selector">
                    <label for="week-selector">V√§lj vecka:</label>
                    <input type="week" id="week-selector">
                    <button class="btn btn-primary" onclick="loadSchedule()">Ladda schema</button>
                </div>

                <div id="schedule-container">
                    <div class="no-schedule">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h4>V√§lj en vecka f√∂r att visa schema</h4>
                        <p>Schema och lektioner visas h√§r n√§r du v√§ljer en vecka.</p>
                    </div>
                </div>
            </div>

            <!-- Fr√•nvaroanm√§lningar sektion -->
            <div class="section">
                <h3>üìù Fr√•nvaroanm√§lningar</h3>
                
                <div id="absence-reports">
                    <div class="no-schedule">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <h4>Inga fr√•nvaroanm√§lningar √§nnu</h4>
                        <p>Rapporterade fr√•nvaroanm√§lningar visas h√§r.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fr√•nvaroanm√§lan modal -->
        <div id="absence-modal" class="modal">
            <div class="modal-content">
                <h3>üìù Anm√§l fr√•nvaro</h3>
                
                <div class="absence-form">
                    <h4 id="modal-lesson-info">Lektion detaljer</h4>
                    
                    <form id="absence-form">
                        <div class="form-group">
                            <label for="absence-type">Typ av fr√•nvaro:</label>
                            <select id="absence-type" name="absence-type" required>
                                <option value="">V√§lj typ</option>
                                <option value="sjukdom">Sjukdom</option>
                                <option value="l√§karbes√∂k">L√§karbes√∂k</option>
                                <option value="tandl√§karbes√∂k">Tandl√§karbes√∂k</option>
                                <option value="familjeangelegenhet">Familjeangelegenhet</option>
                                <option value="√∂vrig">√ñvrig orsak</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="absence-reason">Beskrivning/Orsak:</label>
                            <textarea id="absence-reason" name="absence-reason" placeholder="Beskriv orsaken till fr√•nvaron..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="absence-date">Datum f√∂r fr√•nvaro:</label>
                            <input type="date" id="absence-date" name="absence-date" required readonly>
                        </div>

                        <div class="form-group">
                            <label for="parent-phone">Ditt telefonnummer:</label>
                            <input type="tel" id="parent-phone" name="parent-phone" placeholder="070-123 45 67" required>
                        </div>

                        <div class="form-buttons">
                            <button type="button" class="btn btn-secondary" onclick="closeAbsenceModal()">Avbryt</button>
                            <button type="submit" class="btn btn-primary">Skicka anm√§lan</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Globala variabler
        let currentChild = {{ child.id if child else 'null' }};
        let selectedLesson = null;
        let currentSchedule = [];
        let absenceReports = [];

        // S√§tt aktuell vecka som standard
        document.addEventListener('DOMContentLoaded', function() {
            const weekSelector = document.getElementById('week-selector');
            const today = new Date();
            const year = today.getFullYear();
            const week = getWeekNumber(today);
            weekSelector.value = `${year}-W${week.toString().padStart(2, '0')}`;
            
            // Ladda initial data
            loadAbsenceReports();
        });

        // H√§mta veckonummer
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }


        async function reportQuickAbsence(lesson) {

            

            // 1) Fr√•ga efter orsak
            const reason = window.prompt(
                `Ange orsak till fr√•nvaro f√∂r ${lesson.subject} den ${lesson.date}:`,
                ''
            );
            if (!reason) {
                alert('Du m√•ste ange en orsak f√∂r att kunna rapportera fr√•nvaro.');
                return;
            }

            // 2) Fr√•ga efter telefonnummer
            const phone = window.prompt(
                'Ange ditt telefonnummer (t.ex. 070-123 45 67):',
                ''
            );
            if (!phone) {
                alert('Du m√•ste ange ett telefonnummer f√∂r att kunna rapportera fr√•nvaro.');
                return;
            }

            // 3) Bygg payload enligt API
            const absenceData = {
                student_id: currentChild,
                date: lesson.date,
                time: `${lesson.start_time} - ${lesson.end_time}`,
                subject: lesson.subject,
                type: 'sjukdom',   // eller h√•rdkoda/ut√∂ka prompt om du vill
                schedule_id: lesson.id,
                reason: reason,
                parent_phone: phone
            };

            try {
                const response = await fetch('/api/parent/report-absence', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(absenceData)
                });
                const result = await response.json();

                if (result.status === 'success') {
                alert('Fr√•nvaro anm√§ld!');
                loadAbsenceReports();
                loadSchedule();
                } else {
                alert(result.message || 'Fel vid fr√•nvarorapportering');
                }
            } catch (err) {
                console.error(err);
                alert('Ett fel uppstod vid fr√•nvarorapporteringen');
            }
            }



        // Ladda schema f√∂r vald vecka
        async function loadSchedule() {
            const weekSelector = document.getElementById('week-selector');
            const selectedWeek = weekSelector.value;
            
            if (!selectedWeek) {
                alert('V√§nligen v√§lj en vecka');
                return;
            }

            try {
                showLoading('schedule-container');
                
                const response = await fetch(`/api/parent/schedule/${selectedWeek}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    currentSchedule = data.schedule;
                    displaySchedule(data.schedule);
                } else {
                    showError('schedule-container', data.message || 'Kunde inte ladda schema');
                }
            } catch (error) {
                console.error('Error loading schedule:', error);
                showError('schedule-container', 'Ett fel uppstod vid laddning av schema');
            }
        }

        // Visa schema
        function displaySchedule(schedule) {
            const container = document.getElementById('schedule-container');
            
            if (!schedule || schedule.length === 0) {
                container.innerHTML = `
                    <div class="no-schedule">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <h4>Inget schema f√∂r denna vecka</h4>
                        <p>Det finns inga schemalagda lektioner f√∂r den valda veckan.</p>
                    </div>
                `;
                return;
            }

            // Gruppera lektioner per dag
            const scheduleByDay = groupScheduleByDay(schedule);
            
            let html = '';
            const weekdays = ['m√•ndag', 'tisdag', 'onsdag', 'torsdag', 'fredag'];
            
            weekdays.forEach(day => {
                const dayLessons = scheduleByDay[day] || [];
                
                html += `
                    <div class="schedule-day">
                        <div class="day-header">
                            <span>${day.charAt(0).toUpperCase() + day.slice(1)}</span>
                            <span>${dayLessons.length} lektioner</span>
                        </div>
                `;
                
                if (dayLessons.length === 0) {
                    html += `
                        <div class="lesson" style="justify-content: center; color: #718096;">
                            Inga lektioner denna dag
                        </div>
                    `;
                } else {
                    dayLessons.forEach(lesson => {
                        const hasAbsenceReport = absenceReports.some(report => 
                            report.lesson_date === lesson.date && report.subject_name === lesson.subject
                        );
                        
                        html += `
                            <div class="lesson">
                                <div class="lesson-info">
                                <div class="lesson-time">${lesson.start_time} - ${lesson.end_time}</div>
                                <div class="lesson-subject">${lesson.subject}</div>
                                <div class="lesson-room">üìç ${lesson.room}</div>
                                </div>
                                <button
                                class="absence-btn ${hasAbsenceReport ? 'reported' : ''}"
                                onclick='reportQuickAbsence(${JSON.stringify(lesson)})'>
                                ${hasAbsenceReport ? 'Fr√•nvaro anm√§ld' : 'Anm√§l fr√•nvaro'}
                                </button>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }

        // Gruppera schema per dag
        function groupScheduleByDay(schedule) {
            const grouped = {};
            
            schedule.forEach(lesson => {
                const day = lesson.weekday;
                if (!grouped[day]) {
                    grouped[day] = [];
                }
                grouped[day].push(lesson);
            });
            
            // Sortera lektioner inom varje dag efter tid
            Object.keys(grouped).forEach(day => {
                grouped[day].sort((a, b) => a.start_time.localeCompare(b.start_time));
            });
            
            return grouped;
        }

        // √ñppna fr√•nvaroanm√§lan modal
        function openAbsenceModal(lesson) {
            selectedLesson = lesson;
            const modal = document.getElementById('absence-modal');
            const lessonInfo = document.getElementById('modal-lesson-info');
            const dateInput = document.getElementById('absence-date');
            
            lessonInfo.textContent = `${lesson.subject} - ${lesson.start_time} - ${lesson.end_time} (${lesson.weekday})`;
            dateInput.value = lesson.date;
            
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // St√§ng fr√•nvaroanm√§lan modal
        function closeAbsenceModal() {
            const modal = document.getElementById('absence-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Rensa formul√§r
            document.getElementById('absence-form').reset();
            selectedLesson = null;
        }

        // Hantera fr√•nvaroanm√§lan
        document.getElementById('absence-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedLesson) {
                alert('Ingen lektion vald');
                return;
            }
            
            const formData = new FormData(e.target);
            const absenceData = {
                lesson_date: formData.get('absence-date'),
                lesson_time: `${selectedLesson.start_time} - ${selectedLesson.end_time}`,
                subject_name: selectedLesson.subject,
                type: formData.get('absence-type'),
                reason: formData.get('absence-reason'),
                parent_phone: formData.get('parent-phone'),
                student_id: currentChild
            };
            
            try {
                const response = await fetch('/api/parent/report-absence', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(absenceData)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showFlashMessage('Fr√•nvaroanm√§lan skickad!', 'success');
                    closeAbsenceModal();
                    loadAbsenceReports();
                    loadSchedule(); // Uppdatera schema f√∂r att visa anm√§ld status
                } else {
                    alert(result.message || 'Fel vid skickning av anm√§lan');
                }
            } catch (error) {
                console.error('Error reporting absence:', error);
                alert('Ett fel uppstod vid skickning av anm√§lan');
            }
        });

        // Ladda fr√•nvaroanm√§lningar
        async function loadAbsenceReports() {
            try {
                const response = await fetch('/api/parent/absence-reports');
                const data = await response.json();
                
                if (data.status === 'success') {
                    absenceReports = data.reports;
                    displayAbsenceReports(data.reports);
                } else {
                    console.error('Error loading absence reports:', data.message);
                }
            } catch (error) {
                console.error('Error loading absence reports:', error);
            }
        }

        // Visa fr√•nvaroanm√§lningar
        function displayAbsenceReports(reports) {
            const container = document.getElementById('absence-reports');
            
            if (!reports || reports.length === 0) {
                container.innerHTML = `
                    <div class="no-schedule">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <h4>Inga fr√•nvaroanm√§lningar √§nnu</h4>
                        <p>Rapporterade fr√•nvaroanm√§lningar visas h√§r.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            reports.forEach(report => {
                const statusClass = `status-${report.status}`;
                html += `
                <div class="absence-item ${statusClass}">
                    <div class="absence-meta">
                    <span><strong>${report.subject}</strong> - ${formatDate(report.date)}</span>
                    <span class="status-badge ${statusClass}">${getStatusText(report.status)}</span>
                    </div>
                    <div><strong>Typ:</strong> ${getAbsenceTypeText(report.type)}</div>
                    <div><strong>Orsak:</strong> ${report.reason}</div>
                    <div style="font-size: 0.8rem; color: #718096; margin-top: 0.5rem;">
                    Anm√§ld: ${formatDateTime(report.created_at)}
                    </div>
                    <button class="btn btn-secondary" onclick="deleteAbsence(${report.id})">
                    Ta bort
                    </button>
                </div>
                `;
            });
            container.innerHTML = html;
        }

        // Hj√§lpfunktioner
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="no-schedule">
                    <div style="font-size: 2rem;">‚è≥</div>
                    <h4>Laddar...</h4>
                </div>
            `;
        }



        async function deleteAbsence(reportId) {
            if (!confirm('√Ñr du s√§ker p√• att du vill ta bort denna fr√•nvaroanm√§lan?')) return;

            try {
                const response = await fetch(`/api/parent/report-absence/${reportId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                if (result.status === 'success') {
                showFlashMessage('Fr√•nvaroanm√§lan borttagen!', 'success');
                loadAbsenceReports();
                loadSchedule();
                } else {
                alert(result.message || 'Fel vid borttagning');
                }
            } catch (err) {
                console.error(err);
                alert('Ett fel uppstod vid borttagning av anm√§lan');
            }
        }


        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="no-schedule">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: #f56565;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h4>Ett fel uppstod</h4>
                    <p>${message}</p>
                </div>
            `;
        }

        function showFlashMessage(message, type) {
            const flashContainer = document.querySelector('.flash-messages');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            flashContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('sv-SE');
        }

        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleString('sv-SE');
        }

        function getStatusText(status) {
            const statusTexts = {
                'pending': 'V√§ntar',
                'approved': 'Godk√§nd',
                'denied': 'Nekad'
            };
            return statusTexts[status] || status;
        }

        function getAbsenceTypeText(type) {
            const typeTexts = {
                'sjukdom': 'Sjukdom',
                'l√§karbes√∂k': 'L√§karbes√∂k',
                'tandl√§karbes√∂k': 'Tandl√§karbes√∂k',
                'familjeangelegenhet': 'Familjeangelegenhet',
                '√∂vrig': '√ñvrig orsak'
            };
            return typeTexts[type] || type;
        }

        // St√§ng modal vid klick utanf√∂r
        document.getElementById('absence-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAbsenceModal();
            }
        });

        // St√§ng modal med Escape-tangent
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAbsenceModal();
            }
        });
    </script>
</body>
</html>
